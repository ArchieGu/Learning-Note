# 贫血模型的MVC架构

## 什么是贫血模型

MVC三层架构: Model (数据层), View (展示层), Controller (逻辑层)。在Web或App项目采用前后端分离架构后，后端负责暴露接口给前端调用，那么后端项目一般会分为 Repository层（数据访问）、Service层（业务逻辑）、Controller层（暴露接口）。

以下是典型的

贫血模型 (Anemic Domain Model): 只包含数据，不包含业务逻辑的类。

> 贫血模型将数据与操作分离，破坏了面向对象的封装特性（数据本身的操作不受限制），是一种典型的面向过程的编程风格。

## 什么是充血模型

充血模型 (Rich Domain Model)： 数据和对应的业务逻辑被封装在同一个类中。

## 什么是领域驱动设计

领域驱动设计DDD(Domain Driven Design)，用来指导如何解耦业务系统，划分业务模块，定义业务领域模型及其交互。 领域驱动设计是基于充血模型的开发模式。微服务概念的兴起加速了领域驱动设计的盛行。（因为微服务最重要的一点就是针对公司业务，合理的做微服务拆分）。

但实际上，基于充血模型的DDD开发实现的代码也还是遵循MVC三层架构，Repository层（数据访问）、Service层（业务逻辑）、Controller层（暴露接口）。最大的区别在与Service层，RDM的service层包含Service类和Domain类，其中Domain类即包含数据，也包含业务逻辑。而Service类变得很单薄。

> 基于贫血模型的传统开发模式，重Service轻BO；基于充血模型的DDD开发模式，轻Service重Domain。

> **问题：**在基于充血模型的 DDD 开发模式中，将业务逻辑移动到Domain 中，Service 类变得很薄，但在代码设计与实现中，并没有完全将Service 类去掉，这是为什么？Service 类在这种情况下担当的职责是什么？哪些功能逻辑会放到 Service 类中？

1. Service类将用于与Repository交流，调用repository中的方法，获取数据库数据，转化成领域模型，之后再由领域模型来完成业务逻辑，最后再调用repository中的方法，将数据写回数据库。这样操作可以保证领域模型的独立性，不与其他层的代码或者开发框架耦合，将流程性的代码逻辑（从DB中读写数据、映射数据）与领域模型的业务逻辑解耦，让领域模型可以复用。
2. Service类负责跨领域模型的业务聚合功能
3. Service类负责一些非功能性及与第三方系统交互的工作，例如幂等、事务（保持最终一致性）、发邮件、记录日志、调用其他系统的接口等。

### 为什么大部分开发仍基于贫血模式？

1. 当业务逻辑较为简单时，没有必要精心设计充血模型，因为本身的业务逻辑就不多，设计出来的领域模型也就较为单薄。
2. 充血模型的设计难度更高，需要从一开始就设计好针对数据需要暴露哪些操作，定义哪些业务逻辑。而贫血模型只需要定义数据，之后的功能需求可以在Service中定义与追加，不需要事先做太多设计。
3. 思维的固化。

### 什么项目应该优先考虑DDD开发模式？

业务复杂的系统开发，如包含利息计算模型、还款模型等复杂业务的金融系统。

贫血模式与充血模式除了代码层面的不同外，还有开发流程的不同。

在传统贫血模式中，功能需求一般是SQL驱动的，业务逻辑被包裹在一个大的SQL语句中，Service层能做的事并不多。而SQL是针对特定的业务功能写的，复用性差，遇到新的需求只能又写一个类似的类。如果是较为复杂的系统，这样会导致代码越来越混乱，最终导致无法维护。

而DDD开发模式中，需要事先理清所有业务，定义领域模型所包含的属性和方法。所以领域模型相当于可以复用的中间层，新功能需求的开发，都基于之前定义好的领域模型来完成。因此，针对复杂的系统，前期需要做大量的业务调研、领域模型设计。

> 吐槽：互联网兴起之后层出不穷的需求变动，以及短命的项目生存周期，用充血模型遭那个洋罪呢？？？充血模型需要建立在业务本身相对稳定的基础上。

